<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Series Rating Heatmap</title>

<style>
:root {
  --bg:#0d0d0d;
  --txt:#fff;
  --dim:#888;
  --awesome:#3d85c6;
  --great:#38761d;
  --good:#6aa84f;
  --avg:#f1c232;
  --bad:#e69138;
  --low:#cc0000;
}

body {
  background:var(--bg);
  color:var(--txt);
  font-family:system-ui;
  margin:0;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.search-box {
  display:flex;
  gap:10px;
  width:100%;
  max-width:500px;
  margin-bottom:30px;
}

input {
  flex:1;
  padding:12px 18px;
  border-radius:25px;
  border:1px solid #333;
  background:#1a1a1a;
  color:white;
}

button {
  padding:10px 22px;
  border-radius:25px;
  border:none;
  background:#007bff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

#status { margin-bottom:15px; color:var(--dim); }

#mainContainer { display:none; width:100%; max-width:1100px; }

.layout { display:flex; gap:30px; flex-wrap:wrap; }

.sidebar { width:180px; text-align:center; }

.poster { width:100%; border-radius:6px; margin-bottom:12px; }

.grid-wrapper { flex:1; overflow-x:auto; }

.grid {
  display:grid;
  gap:4px;
}

.cell {
  height:34px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:12px;
  font-weight:bold;
  border-radius:3px;
  color:#000;
}

.label {
  font-size:11px;
  color:var(--dim);
  display:flex;
  align-items:center;
  justify-content:center;
}

.season-hdr {
  color:white;
  font-weight:bold;
}

.avg-row {
  margin-top:8px;
  padding-top:8px;
  border-top:1px solid #333;
  color:white;
  font-weight:bold;
}

.c-9 { background:var(--awesome); color:white; }
.c-85 { background:var(--great); color:white; }
.c-8 { background:var(--good); }
.c-7 { background:var(--avg); }
.c-6 { background:var(--bad); }
.c-low { background:var(--low); color:white; }
.c-empty { background:transparent; border:1px solid #222; color:#444; }
</style>
</head>

<body>

<div class="search-box">
  <input id="query" placeholder="Enter series name (e.g. Suits)">
  <button onclick="searchShow()">Search</button>
</div>

<div id="status"></div>

<div id="mainContainer">
  <div class="layout">
    <div class="sidebar">
      <img id="poster" class="poster">
      <h3 id="title"></h3>
      <p id="meta" style="color:var(--dim)"></p>
      <div id="rating"></div>
    </div>

    <div class="grid-wrapper">
      <div id="grid" class="grid"></div>
    </div>
  </div>
</div>

<script>
const KEY = "580602b5";
const API = "https://api.allorigins.win/raw?url=https://www.omdbapi.com/";

async function apiFetch(query) {
  const url = API + encodeURIComponent(query);
  const res = await fetch(url);
  return await res.json();
}

async function searchShow() {
  const q = document.getElementById("query").value.trim();
  if (!q) return;

  status.innerText = "Loading series...";
  mainContainer.style.display = "none";

  try {
    const data = await apiFetch(`?apikey=${KEY}&t=${q}&type=series`);
    if (data.Response === "False") {
      status.innerText = "Series not found.";
      return;
    }

    poster.src = data.Poster !== "N/A" ? data.Poster : "";
    title.innerText = data.Title;
    meta.innerText = `${data.Year} • ${data.totalSeasons} Seasons`;
    rating.innerText = `★ ${data.imdbRating}`;

    const seasons = [];
    for (let i = 1; i <= data.totalSeasons; i++) {
      status.innerText = `Loading season ${i}...`;
      seasons.push(await apiFetch(`?apikey=${KEY}&i=${data.imdbID}&Season=${i}`));
    }

    renderGrid(seasons);
    status.innerText = "";
    mainContainer.style.display = "block";

  } catch (e) {
    console.error(e);
    status.innerText = "Network / proxy error.";
  }
}

function getColor(r) {
  const v = parseFloat(r);
  if (isNaN(v)) return "c-empty";
  if (v >= 9) return "c-9";
  if (v >= 8.5) return "c-85";
  if (v >= 8) return "c-8";
  if (v >= 7) return "c-7";
  if (v >= 6) return "c-6";
  return "c-low";
}

function renderGrid(seasons) {
  const grid = document.getElementById("grid");
  const totalS = seasons.length;
  const maxEp = Math.max(...seasons.map(s => s.Episodes?.length || 0));

  grid.style.gridTemplateColumns = `60px repeat(${totalS}, 55px)`;

  let html = `<div></div>`;
  for (let s = 1; s <= totalS; s++) html += `<div class="label season-hdr">S${s}</div>`;

  for (let e = 0; e < maxEp; e++) {
    html += `<div class="label">E${e + 1}</div>`;
    for (let s = 0; s < totalS; s++) {
      const ep = seasons[s].Episodes?.[e];
      const r = ep?.imdbRating;
      html += `<div class="cell ${getColor(r)}">${!isNaN(parseFloat(r)) ? r : "-"}</div>`;
    }
  }

  html += `<div class="label avg-row">AVG</div>`;
  for (let s = 0; s < totalS; s++) {
    const vals = seasons[s].Episodes
      ?.map(e => parseFloat(e.imdbRating))
      .filter(v => !isNaN(v)) || [];
    const avg = vals.length ? (vals.reduce((a,b)=>a+b)/vals.length).toFixed(1) : "-";
    html += `<div class="label avg-row">${avg}</div>`;
  }

  grid.innerHTML = html;
}
</script>

</body>
</html>
