<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Series Rating Heatmap</title>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --text-main: #ffffff;
            --text-dim: #888888;
            --awesome: #3d85c6; /* 9.0+ */
            --great: #38761d;   /* 8.5+ */
            --good: #6aa84f;    /* 8.0+ */
            --average: #f1c232; /* 7.0+ */
            --bad: #e69138;     /* 6.0+ */
            --garbage: #cc0000; /* < 6.0 */
            --accent: #007bff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* Search Section */
        .search-box {
            margin: 20px 0 40px;
            display: flex; gap: 10px;
            width: 100%; max-width: 500px;
        }
        input {
            flex: 1; padding: 12px 20px; border-radius: 25px;
            border: 1px solid #333; background: #1a1a1a; color: white;
        }
        button {
            padding: 10px 25px; border-radius: 25px; border: none;
            background: var(--accent); color: white; font-weight: bold; cursor: pointer;
        }

        /* Legend */
        .legend {
            display: flex; gap: 15px; margin-bottom: 25px; 
            font-size: 11px; text-transform: uppercase;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        /* Main Container */
        #mainContainer { display: none; width: 100%; max-width: 1100px; }
        .layout { display: flex; gap: 40px; flex-wrap: wrap; }
        .sidebar { width: 180px; flex-shrink: 0; text-align: center; }
        .poster { width: 100%; border-radius: 6px; margin-bottom: 15px; }
        
        /* Grid */
        .grid-wrapper { flex: 1; overflow-x: auto; }
        .grid { display: grid; gap: 4px; }
        .cell {
            height: 35px; display: flex; align-items: center; 
            justify-content: center; font-size: 12px; font-weight: bold;
            border-radius: 2px; color: #000;
        }
        .label { color: var(--text-dim); font-size: 11px; display: flex; align-items: center; justify-content: center; }
        .season-hdr { color: var(--text-main); font-weight: bold; height: 30px; }
        .avg-row { border-top: 1px solid #333; margin-top: 10px; padding-top: 10px; color: var(--text-main); }

        /* Rating Colors */
        .c-9 { background: var(--awesome); color: #fff; }
        .c-85 { background: var(--great); color: #fff; }
        .c-8 { background: var(--good); }
        .c-7 { background: var(--average); }
        .c-6 { background: var(--bad); }
        .c-low { background: var(--garbage); color: #fff; }
        .c-empty { background: transparent; border: 1px solid #222; color: #444; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="query" placeholder="Enter Series Name (e.g. Suits)">
        <button onclick="searchShow()">Search</button>
    </div>

    <div id="status"></div>

    <div id="mainContainer">
        <div class="legend">
            <div class="legend-item"><span class="dot" style="background:var(--awesome)"></span> Awesome</div>
            <div class="legend-item"><span class="dot" style="background:var(--great)"></span> Great</div>
            <div class="legend-item"><span class="dot" style="background:var(--good)"></span> Good</div>
            <div class="legend-item"><span class="dot" style="background:var(--average)"></span> Average</div>
        </div>

        <div class="layout">
            <div class="sidebar">
                <img id="poster" class="poster">
                <h2 id="title" style="margin:0"></h2>
                <p id="meta" style="color:var(--text-dim); font-size:14px"></p>
                <div id="rating" style="font-size:18px; color:var(--average)"></div>
            </div>
            <div class="grid-wrapper">
                <div id="grid" class="grid"></div>
            </div>
        </div>
    </div>

<script>
const KEY = '580602b5';
const API = 'https://cors.isomorphic-git.org/https://www.omdbapi.com/';

async function searchShow() {
    const val = document.getElementById('query').value.trim();
    const status = document.getElementById('status');
    const container = document.getElementById('mainContainer');

    if (!val) return;

    status.innerText = "Loading series data...";
    container.style.display = 'none';

    try {
        let res = await fetch(`${API}?apikey=${KEY}&t=${encodeURIComponent(val)}&type=series`);
        let data = await res.json();

        if (data.Response === "False") {
            status.innerText = "Series not found. Try exact name.";
            return;
        }

        // Sidebar
        poster.src = data.Poster !== "N/A" ? data.Poster : "";
        title.innerText = data.Title;
        meta.innerText = `${data.Year} • ${data.totalSeasons} Seasons`;
        rating.innerText = `★ ${data.imdbRating}`;

        const totalSeasons = Number(data.totalSeasons);
        const seasons = [];

        for (let i = 1; i <= totalSeasons; i++) {
            status.innerText = `Loading Season ${i}...`;
            const sRes = await fetch(`${API}?apikey=${KEY}&i=${data.imdbID}&Season=${i}`);
            seasons.push(await sRes.json());
        }

        renderGrid(seasons);
        status.innerText = "";
        container.style.display = 'block';

    } catch (err) {
        status.innerText = "Network / API error.";
        console.error(err);
    }
}

function getColor(r) {
    const v = parseFloat(r);
    if (isNaN(v)) return 'c-empty';
    if (v >= 9) return 'c-9';
    if (v >= 8.5) return 'c-85';
    if (v >= 8) return 'c-8';
    if (v >= 7) return 'c-7';
    if (v >= 6) return 'c-6';
    return 'c-low';
}

function renderGrid(seasons) {
    const grid = document.getElementById('grid');
    const totalS = seasons.length;
    const maxEp = Math.max(...seasons.map(s => s.Episodes?.length || 0));

    grid.style.gridTemplateColumns = `60px repeat(${totalS}, 55px)`;

    let html = `<div></div>`;
    for (let s = 1; s <= totalS; s++) {
        html += `<div class="label season-hdr">S${s}</div>`;
    }

    for (let e = 0; e < maxEp; e++) {
        html += `<div class="label">E${e + 1}</div>`;
        for (let s = 0; s < totalS; s++) {
            const ep = seasons[s].Episodes?.[e];
            const r = ep?.imdbRating;
            html += `<div class="cell ${getColor(r)}">${!isNaN(parseFloat(r)) ? r : '-'}</div>`;
        }
    }

    html += `<div class="label avg-row">AVG</div>`;
    for (let s = 0; s < totalS; s++) {
        const ratings = seasons[s].Episodes
            ?.map(e => parseFloat(e.imdbRating))
            .filter(v => !isNaN(v)) || [];

        const avg = ratings.length
            ? (ratings.reduce((a, b) => a + b) / ratings.length).toFixed(1)
            : '-';

        html += `<div class="label avg-row">${avg}</div>`;
    }

    grid.innerHTML = html;
}
</script>

